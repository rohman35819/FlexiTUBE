<!DOCTYPE html>
<html>
<head>
    <title>IP Analyzer dengan Scan Jaringan</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 700px; margin: 30px auto; position: relative; }
        input[type="text"], input[type="submit"], input[type="button"] { font-size: 16px; padding: 6px 10px; }
        #scan-section { position: fixed; top: 10px; left: 10px; background: #eee; padding: 10px; border-radius: 5px; box-shadow: 0 0 10px #ccc; width: 250px; }
        #scan-result { margin-top: 10px; max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 5px; background: #fff; }
        #scan-result div { padding: 4px; cursor: pointer; border-bottom: 1px solid #ddd; }
        #scan-result div:hover { background-color: #cceeff; }
        form { margin-top: 100px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .error { color: red; }
    </style>
</head>
<body>

<div id="scan-section">
    <h3>Scan IP di subnet</h3>
    <input type="text" id="subnet" placeholder="Contoh: 192.168.1.0/24" />
    <input type="button" value="Scan" onclick="startScan()" />
    <div id="scan-result"></div>
</div>

<h1>IP Analyzer</h1>
<form method="POST" id="ip-form">
    <input type="text" name="ip" id="ip-input" placeholder="Masukkan IP address" value="{{ ip or '' }}" required />
    <input type="submit" value="Analyze" />
</form>

{% if result %}
    {% if result.error %}
        <p class="error">{{ result.error }}</p>
    {% else %}
        <h2>Hasil Analisis untuk IP: {{ result.IP }}</h2>
        <table>
            {% for key, value in result.items() %}
                {% if key != 'IP' %}
                <tr>
                    <th>{{ key }}</th>
                    <td>{{ value }}</td>
                </tr>
                {% endif %}
            {% endfor %}
        </table>
    {% endif %}
{% endif %}

<script>
async function startScan() {
    const subnet = document.getElementById('subnet').value.trim();
    const resultDiv = document.getElementById('scan-result');
    resultDiv.innerHTML = 'Scanning... tunggu sebentar.';
    if (!subnet) {
        alert('Masukkan subnet yang valid, contoh 192.168.1.0/24');
        resultDiv.innerHTML = '';
        return;
    }
    try {
        const response = await fetch('/scan', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({subnet})
        });
        const data = await response.json();
        if (data.error) {
            alert(data.error);
            resultDiv.innerHTML = '';
            return;
        }
        if (data.active_ips.length === 0) {
            resultDiv.innerHTML = 'Tidak ada IP aktif ditemukan di subnet ini.';
            return;
        }
        resultDiv.innerHTML = '';
        data.active_ips.forEach(ip => {
            const div = document.createElement('div');
            div.textContent = ip;
            div.onclick = () => {
                document.getElementById('ip-input').value = ip;
                document.getElementById('ip-form').scrollIntoView({behavior: 'smooth'});
            };
            resultDiv.appendChild(div);
        });
    } catch (e) {
        resultDiv.innerHTML = 'Gagal melakukan scan: ' + e.message;
    }
}
</script>

</body>
</html>
